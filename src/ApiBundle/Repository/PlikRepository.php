<?php

namespace ApiBundle\Repository;
use ApiBundle\Entity\Plik;
use ApiBundle\Exception\ZasobNieIstniejeException;
use ApiBundle\Model\FizycznyPlik;
use ApiBundle\Model\PrzetworzDane;

/**
 * PlikRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class PlikRepository extends \Doctrine\ORM\EntityRepository
{
    public function pobierzSciezkeDoZasobu($zasob)
    {
        $encja = $this->findOneBy(['idZasobu' => $zasob]);

        if(!$encja instanceof Plik){
            throw new ZasobNieIstniejeException();
        }

        return $encja->getSciezka();
    }

    /**
     * @param $noweDane
     * @param $przetworzDane
     */
    public function zapiszPlikiNaDyskuIUzupelnijDaneWBazie($noweDane, PrzetworzDane $przetworzDane): void
    {
        $managerEncji = $this->getEntityManager();

        foreach ($noweDane['pliki'] as $danePliku){
            $encjaPliku = new Plik();
            $encjaPliku = $przetworzDane->uzupelnijEncjePliku($encjaPliku, $danePliku, $noweDane['uzytkownik']);
            $managerEncji->persist($encjaPliku);
            $managerEncji->flush();
        }
    }
}
